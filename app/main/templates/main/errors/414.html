{% extends 'base.html' %}
{% load static %}

{% block title %}URI Too Long | {{ SITE_NAME }}{% endblock %}

{% block content %}
<div class="container py-5 my-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm">
                <div class="card-body p-5 text-center">
                    <div class="mb-4">
                        <div class="bg-warning bg-opacity-10 d-inline-flex align-items-center justify-content-center rounded-circle" style="width: 120px; height: 120px;">
                            <i class="bi bi-link-45deg text-warning" style="font-size: 4rem;"></i>
                        </div>
                    </div>
                    
                    <h1 class="display-5 fw-bold text-warning mb-3">414</h1>
                    <h2 class="h3 mb-4">URI Too Long</h2>
                    
                    <p class="lead text-muted mb-4">
                        The URL you're trying to access is too long for the server to process.
                    </p>
                    
                    <div class="card bg-light border-0 mb-5">
                        <div class="card-body">
                            <p class="mb-4">This typically happens when:</p>
                            
                            <div class="row g-4 mb-4">
                                <div class="col-md-6">
                                    <div class="p-3 border rounded h-100">
                                        <div class="d-flex align-items-center mb-3">
                                            <div class="bg-primary bg-opacity-10 p-2 rounded-circle me-3">
                                                <i class="bi bi-link-45deg text-primary"></i>
                                            </div>
                                            <h5 class="h6 mb-0">Long URL</h5>
                                        </div>
                                        <p class="small text-muted mb-0">The URL in your browser's address bar exceeds the maximum allowed length.</p>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="p-3 border rounded h-100">
                                        <div class="d-flex align-items-center mb-3">
                                            <div class="bg-info bg-opacity-10 p-2 rounded-circle me-3">
                                                <i class="bi bi-search text-info"></i>
                                            </div>
                                            <h5 class="h6 mb-0">Search Parameters</h5>
                                        </div>
                                        <p class="small text-muted mb-0">Too many search parameters or very long parameter values.</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="alert alert-info">
                                <div class="d-flex">
                                    <i class="bi bi-lightbulb me-3 mt-1"></i>
                                    <div>
                                        <h5 class="h6 mb-2">How to fix this:</h5>
                                        <ul class="mb-0 ps-3">
                                            <li class="mb-1">Shorten the URL by removing unnecessary parameters</li>
                                            <li class="mb-1">Use POST instead of GET for form submissions with large data</li>
                                            <li>Contact the website administrator if you believe this is an error</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-flex flex-wrap justify-content-center gap-3">
                        <a href="{% url 'main:home' %}" class="btn btn-primary px-4">
                            <i class="bi bi-house-door me-2"></i> Go to Homepage
                        </a>
                        <button onclick="window.history.back()" class="btn btn-outline-secondary px-4">
                            <i class="bi bi-arrow-left me-2"></i> Go Back
                        </button>
                        <a href="#" class="btn btn-outline-warning px-4" data-bs-toggle="modal" data-bs-target="#contactModal">
                            <i class="bi bi-question-circle me-2"></i> Need Help?
                        </a>
                    </div>
                    
                    <div class="mt-5">
                        <p class="text-muted small mb-1">If you continue to experience issues, please contact support:</p>
                        <a href="mailto:{{ CONTACT_EMAIL }}" class="text-decoration-none">
                            <i class="bi bi-envelope me-1"></i> {{ CONTACT_EMAIL }}
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Contact Support Modal -->
<div class="modal fade" id="contactModal" tabindex="-1" aria-labelledby="contactModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="contactModalLabel">Contact Support</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="supportForm">
                    <div class="mb-3">
                        <label for="name" class="form-label">Your Name</label>
                        <input type="text" class="form-control" id="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="email" class="form-label">Email Address</label>
                        <input type="email" class="form-control" id="email" required>
                    </div>
                    <div class="mb-3">
                        <label for="message" class="form-label">How can we help?</label>
                        <textarea class="form-control" id="message" rows="4" required></textarea>
                        <div class="form-text">Please include any error messages or steps to reproduce the issue.</div>
                    </div>
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="includeUrl" checked>
                            <label class="form-check-label" for="includeUrl">
                                Include current page URL
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" form="supportForm" class="btn btn-primary">
                    <i class="bi bi-send me-1"></i> Send Message
                </button>
            </div>
        </div>
    </div>
</div>

{% if request.sentry and request.sentry.id %}
<div class="container mb-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-light">
                    <h6 class="mb-0">Error Reference</h6>
                </div>
                <div class="card-body">
                    <p class="small text-muted mb-3">
                        If you're contacting support, please include this reference ID:
                    </p>
                    <div class="d-flex align-items-center">
                        <code class="bg-light p-2 rounded flex-grow-1">{{ request.sentry.id }}</code>
                        <button class="btn btn-sm btn-outline-secondary ms-2" onclick="copyToClipboard('{{ request.sentry.id }}')">
                            <i class="bi bi-clipboard me-1"></i> Copy
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

{% block extra_js %}
<script>
// Initialize Bootstrap components
var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl);
});

// Copy to clipboard function
function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(function() {
        const button = event.target.closest('button');
        const originalHTML = button.innerHTML;
        button.innerHTML = '<i class="bi bi-check2 me-1"></i> Copied!';
        button.classList.remove('btn-outline-secondary');
        button.classList.add('btn-success');
        
        setTimeout(function() {
            button.innerHTML = originalHTML;
            button.classList.remove('btn-success');
            button.classList.add('btn-outline-secondary');
        }, 2000);
    }).catch(function(err) {
        console.error('Could not copy text: ', err);
    });
}

// Handle support form submission
document.getElementById('supportForm')?.addEventListener('submit', function(e) {
    e.preventDefault();
    
    // In a real application, you would send this data to your server
    alert('Thank you for your message! Our support team will get back to you soon.');
    
    // Close the modal
    var modal = bootstrap.Modal.getInstance(document.getElementById('contactModal'));
    modal.hide();
    
    // Reset the form
    this.reset();
});

// Add current URL to the support form if checkbox is checked
const includeUrlCheckbox = document.getElementById('includeUrl');
const messageTextarea = document.getElementById('message');

if (includeUrlCheckbox && messageTextarea) {
    includeUrlCheckbox.addEventListener('change', function() {
        if (this.checked) {
            messageTextarea.value = messageTextarea.value.replace(/\n\nCurrent URL: .+$/, '');
            messageTextarea.value += '\n\nCurrent URL: ' + window.location.href;
        } else {
            messageTextarea.value = messageTextarea.value.replace(/\n\nCurrent URL: .+$/, '');
        }
    });
    
    // Trigger the change event to set initial value
    includeUrlCheckbox.dispatchEvent(new Event('change'));
}
</script>
{% endblock %}

{% endblock %}
